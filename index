<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Shopping List</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --primary:#4f46e5;
  --success:#16a34a;
  --danger:#dc2626;
  --bg:#f1f5f9;
  --card:#ffffff;
  --border:#e5e7eb;
  --text:#0f172a;
  --muted:#64748b;
}

*{box-sizing:border-box}

body{
  margin:0;
  background:var(--bg);
  font-family:"Segoe UI",system-ui,sans-serif;
  padding:16px;
}

.container{
  max-width:520px;
  margin:auto;
  background:var(--card);
  border-radius:18px;
  padding:16px;
  box-shadow:0 20px 40px rgba(0,0,0,.1);
}

h2{text-align:center;margin:6px 0 12px}

/* INPUT */
input{
  width:100%;
  height:46px;
  border-radius:12px;
  border:1px solid var(--border);
  padding:0 14px;
  font-size:15px;
}

input:focus{outline:none;border-color:var(--primary)}

/* SUGGESTIONS */
.suggestions{
  border:1px solid var(--border);
  border-top:none;
  border-radius:0 0 12px 12px;
  max-height:160px;
  overflow:auto;
}
.suggestions div{
  padding:12px;
  cursor:pointer;
}
.suggestions div:hover{background:#eef2ff}

/* ITEM */
.item{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:16px;
  margin-top:10px;
  border:1px solid var(--border);
  border-radius:14px;
  background:#f9fafb;
  cursor:pointer;
}
.item:active{transform:scale(.98)}
.item-name{font-weight:600}
.item-price{color:var(--success);font-weight:700}

/* BASKET */
.basket{
  margin-top:18px;
  border-top:2px dashed var(--border);
  padding-top:14px;
}

.basket-item{
  display:grid;
  grid-template-columns:1fr auto;
  gap:10px;
  padding:12px 0;
  border-bottom:1px solid var(--border);
}

.qty-row{
  display:flex;
  align-items:center;
  gap:8px;
  margin-top:6px;
}

.qty-row input{
  width:90px;
  height:38px;
  border-radius:10px;
  text-align:center;
}

.remove{
  color:var(--danger);
  font-size:13px;
  cursor:pointer;
}

.custom-tag{
  font-size:11px;
  color:var(--muted);
}

/* BUTTON */
button{
  width:100%;
  height:46px;
  margin-top:12px;
  border:none;
  border-radius:14px;
  background:var(--primary);
  color:#fff;
  font-size:16px;
  cursor:pointer;
}

.add-custom{
  background:#6b7280;
}
</style>
</head>

<body>

<div class="container">
  <h2>ðŸ›’ Shopping List</h2>

  <input id="dealerInput" placeholder="Select storeâ€¦" oninput="filterDealers()">
  <div id="dealerSug" class="suggestions"></div>

  <div id="items"></div>

  <!-- ADD CUSTOM ITEM -->
  <button class="add-custom" onclick="addCustomItem()">âž• Not in the list?</button>

  <div id="basket" class="basket" style="display:none">
    <h3>Your List</h3>
    <div id="basketItems"></div>
    <button onclick="sendToWhatsApp()">Send Shopping List</button>
  </div>
</div>

<script>
const API_URL="https://script.google.com/macros/s/AKfycbzRt_ad2rXgZNVO4_Nlumm8EAxN7jcG7gG1y0yKEec7WXnws68ygcAqrhCjRzcmdWzl/exec";
const API_KEY="9848o22338B!";
const WHATSAPP_NUMBER="919603007016";

let groceries={}, dealers=[], cart={};
const basketBox=document.getElementById("basket");

fetch(`${API_URL}?key=${API_KEY}`)
  .then(r=>r.json())
  .then(d=>{groceries=d||{};initDealers();});

function initDealers(){
  const s=new Set();
  Object.values(groceries).forEach(a=>a.forEach(d=>s.add(d.dealer)));
  dealers=[...s];
}

function filterDealers(){
  dealerSug.innerHTML="";
  const v=dealerInput.value.toLowerCase();
  if(!v) return;
  dealers.filter(d=>d.toLowerCase().includes(v)).forEach(d=>{
    const div=document.createElement("div");
    div.textContent=d;
    div.onclick=()=>selectDealer(d);
    dealerSug.appendChild(div);
  });
}

function selectDealer(dealer){
  dealerInput.value=dealer;
  dealerSug.innerHTML="";
  cart={};
  renderBasket();
  showItems(dealer);
}

function showItems(dealer){
  items.innerHTML="";
  Object.keys(groceries).forEach(item=>{
    groceries[item].forEach(d=>{
      if(d.dealer===dealer){
        items.innerHTML+=`
        <div class="item" onclick="addItem('${item}',${d.price})">
          <div class="item-name">${item}</div>
          <div class="item-price">â‚¹${d.price}</div>
        </div>`;
      }
    });
  });
}

function addItem(item,price){
  if(!cart[item]) cart[item]={price,qty:1,custom:false};
  renderBasket();
}

function addCustomItem(){
  const name=prompt("Enter item name");
  if(!name) return;
  cart[name]={qty:1,custom:true};
  renderBasket();
}

function updateQty(item,val){
  const q=parseFloat(val);
  if(!q||q<=0) delete cart[item];
  else cart[item].qty=parseFloat(q.toFixed(2));
  renderBasket();
}

function renderBasket(){
  basketItems.innerHTML="";
  Object.keys(cart).forEach(item=>{
    const b=cart[item];
    basketItems.innerHTML+=`
      <div class="basket-item">
        <div>
          <strong>${item}</strong>
          ${b.custom?'<span class="custom-tag">(Custom)</span>':''}
          ${b.price?`<br>â‚¹${b.price} per unit`:''}
          <div class="qty-row">
            <input type="number" step="0.01" min="0"
              value="${b.qty}"
              onchange="updateQty('${item}',this.value)">
            <span class="remove" onclick="updateQty('${item}',0)">Remove</span>
          </div>
        </div>
      </div>`;
  });

  basketBox.style.display=Object.keys(cart).length?"block":"none";
}

function sendToWhatsApp(){
  if(!Object.keys(cart).length){
    alert("Shopping list is empty");
    return;
  }

  let msg="ðŸ›’ *SHOPPING LIST*\n\n";
  Object.keys(cart).forEach(item=>{
    const b=cart[item];
    msg+=`â€¢ ${item} â€“ Qty: ${b.qty}\n`;
  });

  const url=`https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(msg)}`;
  window.open(url,"_blank");
}
</script>

</body>
</html>
